"use strict";function cov_1p5np8cele(){var path="/Users/taojiang/Documents/work/redux_study/redux_/src/applyMiddleWares.ts";var hash="d27dfbd65320aef20542e4cb51129bca7b366448";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/taojiang/Documents/work/redux_study/redux_/src/applyMiddleWares.ts",statementMap:{"0":{start:{line:2,column:0},end:{line:2,column:62}},"1":{start:{line:3,column:18},end:{line:3,column:38}},"2":{start:{line:12,column:25},end:{line:29,column:1}},"3":{start:{line:14,column:4},end:{line:28,column:6}},"4":{start:{line:16,column:8},end:{line:27,column:10}},"5":{start:{line:17,column:12},end:{line:17,column:44}},"6":{start:{line:18,column:24},end:{line:18,column:60}},"7":{start:{line:20,column:24},end:{line:22,column:14}},"8":{start:{line:21,column:16},end:{line:21,column:50}},"9":{start:{line:24,column:27},end:{line:24,column:70}},"10":{start:{line:25,column:12},end:{line:25,column:38}},"11":{start:{line:26,column:12},end:{line:26,column:25}},"12":{start:{line:30,column:0},end:{line:30,column:44}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:12,column:25},end:{line:12,column:26}},loc:{start:{line:12,column:45},end:{line:29,column:1}},line:12},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:11},end:{line:14,column:12}},loc:{start:{line:14,column:33},end:{line:28,column:5}},line:14},"2":{name:"newCreateStore",decl:{start:{line:16,column:24},end:{line:16,column:38}},loc:{start:{line:16,column:59},end:{line:27,column:9}},line:16},"3":{name:"(anonymous_3)",decl:{start:{line:20,column:40},end:{line:20,column:41}},loc:{start:{line:20,column:54},end:{line:22,column:13}},line:20}},branchMap:{},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},f:{"0":0,"1":0,"2":0,"3":0},b:{},inputSourceMap:{version:3,file:"/Users/taojiang/Documents/work/redux_study/redux_/src/applyMiddleWares.ts",sources:["/Users/taojiang/Documents/work/redux_study/redux_/src/applyMiddleWares.ts"],names:[],mappings:";;AACA,uCAAoC;AAQpC;;;;;;;GAOG;AACH,MAAM,gBAAgB,GAAG,CAAC,GAAG,WAAyB,EAAE,EAAE;IAExD,uCAAuC;IACvC,OAAO,CAAC,gBAA0B,EAAE,EAAE;QAEpC,+CAA+C;QAC/C,OAAO,SAAS,cAAc,CAAC,OAAgB,EAAE,SAAc;YAC7D,OAAO,CAAC,GAAG,CAAC,OAAO,EAAC,SAAS,CAAC,CAAC;YAC/B,IAAI,KAAK,GAAU,gBAAgB,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;YAExD,cAAc;YACd,IAAI,KAAK,GAAG,WAAW,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE;gBACvC,OAAO,UAAU,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;YACpC,CAAC,CAAC,CAAA;YAEF,wCAAwC;YACxC,IAAI,QAAQ,GAAG,iBAAO,CAAC,GAAG,KAAK,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;YACjD,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAC;YAC1B,OAAO,KAAK,CAAC;QACf,CAAC,CAAA;IACH,CAAC,CAAA;AACH,CAAC,CAAA;AAEQ,4CAAgB",sourcesContent:["import { Reducer, AnyAction } from '.';\nimport { compose } from './compose';\nimport { Store } from './createStore';\n\n/**\n * \u5B9A\u4E49Middleware \u6D0B\u8471\u6A21\u578B \u4E00\u4E2A\u4E09\u6B21\u95ED\u5305\u7684\u4E2D\u95F4\u51FD\u6570\n */\ntype Middleware = (stateFn: () => any) => (next: Reducer) => (action: AnyAction) => void;\n\n/**\n * \u4E2D\u95F4\u4EF6\uFF0C\n * \n * 1.\u5148\u7528\u6D0B\u8471\u6A21\u578B\uFF0C\ba(),b(),c() = a(b(c())) \u8FD9\u4E2A\u7684\u65B9\u5F0F\u5305\u88F9 dispatch;\n * \u9700\u8981\u91CD\u5199 createStore \u4EE5\u53CA\u9700\u8981\u5427 store.dispatch \u7ED9\u66FF\u6362\u6389\n * \n * @param middlewares \n */\nconst applyMiddleWares = (...middlewares: Middleware[]) => {\n\n  /**oldCreateStoreFN \u662F\u4E4B\u524D\u7684 createStore */\n  return (oldCreateStoreFN: Function) => {\n\n    /**\u8FD9\u91CC\u91CD\u5199\u4E86 createStore \u65B9\u6CD5\u5E76\u4E14 \u66FF\u6362\u4E86 dispatch \u7684\u51FD\u6570\u56E0\u5B50 */\n    return function newCreateStore(reducer: Reducer, initState: any) {\n      console.log(reducer,initState);\n      let store: Store = oldCreateStoreFN(reducer, initState);\n\n      //\u8BBE\u7F6E\u4E2D\u95F4\u4EF6\u7684 state\n      let chain = middlewares.map(middleware => {\n        return middleware(store.getState);\n      })\n\n      /**\u4E2D\u95F4\u4EF6\u5305\u88F9 .dispatch \u65B9\u6CD5\uFF0C\u8FD9\u4E2A\u662F\u4E00\u4E2A\u7EC4\u5408\u9897\u7C92\u5316\u7684\u4E00\u4E2A\u8FC7\u7A0B */\n      let dispatch = compose(...chain)(store.dispatch);\n      store.dispatch = dispatch;\n      return store;\n    }\n  }\n}\n\nexport { applyMiddleWares, Middleware }"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"d27dfbd65320aef20542e4cb51129bca7b366448"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1p5np8cele=function(){return actualCoverage;};return actualCoverage;}cov_1p5np8cele();cov_1p5np8cele().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});const compose_1=(cov_1p5np8cele().s[1]++,require("./compose"));/**
 * 中间件，
 *
 * 1.先用洋葱模型，a(),b(),c() = a(b(c())) 这个的方式包裹 dispatch;
 * 需要重写 createStore 以及需要吧 store.dispatch 给替换掉
 *
 * @param middlewares
 */cov_1p5np8cele().s[2]++;const applyMiddleWares=(...middlewares)=>{cov_1p5np8cele().f[0]++;cov_1p5np8cele().s[3]++;/**oldCreateStoreFN 是之前的 createStore */return oldCreateStoreFN=>{cov_1p5np8cele().f[1]++;cov_1p5np8cele().s[4]++;/**这里重写了 createStore 方法并且 替换了 dispatch 的函数因子 */return function newCreateStore(reducer,initState){cov_1p5np8cele().f[2]++;cov_1p5np8cele().s[5]++;console.log(reducer,initState);let store=(cov_1p5np8cele().s[6]++,oldCreateStoreFN(reducer,initState));//设置中间件的 state
let chain=(cov_1p5np8cele().s[7]++,middlewares.map(middleware=>{cov_1p5np8cele().f[3]++;cov_1p5np8cele().s[8]++;return middleware(store.getState);}));/**中间件包裹 .dispatch 方法，这个是一个组合颗粒化的一个过程 */let dispatch=(cov_1p5np8cele().s[9]++,compose_1.compose(...chain)(store.dispatch));cov_1p5np8cele().s[10]++;store.dispatch=dispatch;cov_1p5np8cele().s[11]++;return store;};};};cov_1p5np8cele().s[12]++;exports.applyMiddleWares=applyMiddleWares;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3Rhb2ppYW5nL0RvY3VtZW50cy93b3JrL3JlZHV4X3N0dWR5L3JlZHV4Xy9zcmMvYXBwbHlNaWRkbGVXYXJlcy50cyIsInNvdXJjZXMiOlsiL1VzZXJzL3Rhb2ppYW5nL0RvY3VtZW50cy93b3JrL3JlZHV4X3N0dWR5L3JlZHV4Xy9zcmMvYXBwbHlNaWRkbGVXYXJlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHVDQUFvQztBQVFwQzs7Ozs7OztHQU9HO0FBQ0gsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLEdBQUcsV0FBeUIsRUFBRSxFQUFFO0lBRXhELHVDQUF1QztJQUN2QyxPQUFPLENBQUMsZ0JBQTBCLEVBQUUsRUFBRTtRQUVwQywrQ0FBK0M7UUFDL0MsT0FBTyxTQUFTLGNBQWMsQ0FBQyxPQUFnQixFQUFFLFNBQWM7WUFDN0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUMsU0FBUyxDQUFDLENBQUM7WUFDL0IsSUFBSSxLQUFLLEdBQVUsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBRXhELGNBQWM7WUFDZCxJQUFJLEtBQUssR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUN2QyxPQUFPLFVBQVUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDcEMsQ0FBQyxDQUFDLENBQUE7WUFFRix3Q0FBd0M7WUFDeEMsSUFBSSxRQUFRLEdBQUcsaUJBQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNqRCxLQUFLLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztZQUMxQixPQUFPLEtBQUssQ0FBQztRQUNmLENBQUMsQ0FBQTtJQUNILENBQUMsQ0FBQTtBQUNILENBQUMsQ0FBQTtBQUVRLDRDQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlZHVjZXIsIEFueUFjdGlvbiB9IGZyb20gJy4nO1xuaW1wb3J0IHsgY29tcG9zZSB9IGZyb20gJy4vY29tcG9zZSc7XG5pbXBvcnQgeyBTdG9yZSB9IGZyb20gJy4vY3JlYXRlU3RvcmUnO1xuXG4vKipcbiAqIOWumuS5iU1pZGRsZXdhcmUg5rSL6JGx5qih5Z6LIOS4gOS4quS4ieasoemXreWMheeahOS4remXtOWHveaVsFxuICovXG50eXBlIE1pZGRsZXdhcmUgPSAoc3RhdGVGbjogKCkgPT4gYW55KSA9PiAobmV4dDogUmVkdWNlcikgPT4gKGFjdGlvbjogQW55QWN0aW9uKSA9PiB2b2lkO1xuXG4vKipcbiAqIOS4remXtOS7tu+8jFxuICogXG4gKiAxLuWFiOeUqOa0i+iRseaooeWei++8jFxiYSgpLGIoKSxjKCkgPSBhKGIoYygpKSkg6L+Z5Liq55qE5pa55byP5YyF6KO5IGRpc3BhdGNoO1xuICog6ZyA6KaB6YeN5YaZIGNyZWF0ZVN0b3JlIOS7peWPiumcgOimgeWQpyBzdG9yZS5kaXNwYXRjaCDnu5nmm7/mjaLmjolcbiAqIFxuICogQHBhcmFtIG1pZGRsZXdhcmVzIFxuICovXG5jb25zdCBhcHBseU1pZGRsZVdhcmVzID0gKC4uLm1pZGRsZXdhcmVzOiBNaWRkbGV3YXJlW10pID0+IHtcblxuICAvKipvbGRDcmVhdGVTdG9yZUZOIOaYr+S5i+WJjeeahCBjcmVhdGVTdG9yZSAqL1xuICByZXR1cm4gKG9sZENyZWF0ZVN0b3JlRk46IEZ1bmN0aW9uKSA9PiB7XG5cbiAgICAvKirov5nph4zph43lhpnkuoYgY3JlYXRlU3RvcmUg5pa55rOV5bm25LiUIOabv+aNouS6hiBkaXNwYXRjaCDnmoTlh73mlbDlm6DlrZAgKi9cbiAgICByZXR1cm4gZnVuY3Rpb24gbmV3Q3JlYXRlU3RvcmUocmVkdWNlcjogUmVkdWNlciwgaW5pdFN0YXRlOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUubG9nKHJlZHVjZXIsaW5pdFN0YXRlKTtcbiAgICAgIGxldCBzdG9yZTogU3RvcmUgPSBvbGRDcmVhdGVTdG9yZUZOKHJlZHVjZXIsIGluaXRTdGF0ZSk7XG5cbiAgICAgIC8v6K6+572u5Lit6Ze05Lu255qEIHN0YXRlXG4gICAgICBsZXQgY2hhaW4gPSBtaWRkbGV3YXJlcy5tYXAobWlkZGxld2FyZSA9PiB7XG4gICAgICAgIHJldHVybiBtaWRkbGV3YXJlKHN0b3JlLmdldFN0YXRlKTtcbiAgICAgIH0pXG5cbiAgICAgIC8qKuS4remXtOS7tuWMheijuSAuZGlzcGF0Y2gg5pa55rOV77yM6L+Z5Liq5piv5LiA5Liq57uE5ZCI6aKX57KS5YyW55qE5LiA5Liq6L+H56iLICovXG4gICAgICBsZXQgZGlzcGF0Y2ggPSBjb21wb3NlKC4uLmNoYWluKShzdG9yZS5kaXNwYXRjaCk7XG4gICAgICBzdG9yZS5kaXNwYXRjaCA9IGRpc3BhdGNoO1xuICAgICAgcmV0dXJuIHN0b3JlO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgeyBhcHBseU1pZGRsZVdhcmVzLCBNaWRkbGV3YXJlIH0iXX0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy90YW9qaWFuZy9Eb2N1bWVudHMvd29yay9yZWR1eF9zdHVkeS9yZWR1eF8vc3JjL2FwcGx5TWlkZGxlV2FyZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjBuSkFDQSxLQUFBLENBQUEsU0FBQSwwQkFBQSxPQUFBLENBQUEsV0FBQSxDQUFBLENBQUEsQ0FRQTs7Ozs7OzsyQkFRQSxLQUFNLENBQUEsZ0JBQWdCLENBQUcsQ0FBQyxHQUFHLFdBQUosR0FBaUMsaURBRXhELHVDQUNBLE1BQVEsQ0FBQSxnQkFBRCxFQUErQixpREFFcEMsK0NBQ0EsTUFBTyxTQUFTLENBQUEsY0FBVCxDQUF3QixPQUF4QixDQUEwQyxTQUExQyxDQUF3RCxpREFDN0QsT0FBTyxDQUFDLEdBQVIsQ0FBWSxPQUFaLENBQW9CLFNBQXBCLEVBQ0EsR0FBSSxDQUFBLEtBQUssMEJBQVUsZ0JBQWdCLENBQUMsT0FBRCxDQUFVLFNBQVYsQ0FBMUIsQ0FBVCxDQUVBO0FBQ0EsR0FBSSxDQUFBLEtBQUssMEJBQUcsV0FBVyxDQUFDLEdBQVosQ0FBZ0IsVUFBVSxFQUFHLGlEQUN2QyxNQUFPLENBQUEsVUFBVSxDQUFDLEtBQUssQ0FBQyxRQUFQLENBQWpCLENBQ0QsQ0FGVyxDQUFILENBQVQsQ0FJQSx3Q0FDQSxHQUFJLENBQUEsUUFBUSwwQkFBRyxTQUFBLENBQUEsT0FBQSxDQUFRLEdBQUcsS0FBWCxFQUFrQixLQUFLLENBQUMsUUFBeEIsQ0FBSCxDQUFaLENBVjZELHlCQVc3RCxLQUFLLENBQUMsUUFBTixDQUFpQixRQUFqQixDQVg2RCx5QkFZN0QsTUFBTyxDQUFBLEtBQVAsQ0FDRCxDQWJELENBY0QsQ0FqQkQsQ0FrQkQsQ0FyQkQsQyx5QkF1QlMsT0FBQSxDQUFBLGdCQUFBLENBQUEsZ0JBQUEsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlZHVjZXIsIEFueUFjdGlvbiB9IGZyb20gJy4nO1xuaW1wb3J0IHsgY29tcG9zZSB9IGZyb20gJy4vY29tcG9zZSc7XG5pbXBvcnQgeyBTdG9yZSB9IGZyb20gJy4vY3JlYXRlU3RvcmUnO1xuXG4vKipcbiAqIOWumuS5iU1pZGRsZXdhcmUg5rSL6JGx5qih5Z6LIOS4gOS4quS4ieasoemXreWMheeahOS4remXtOWHveaVsFxuICovXG50eXBlIE1pZGRsZXdhcmUgPSAoc3RhdGVGbjogKCkgPT4gYW55KSA9PiAobmV4dDogUmVkdWNlcikgPT4gKGFjdGlvbjogQW55QWN0aW9uKSA9PiB2b2lkO1xuXG4vKipcbiAqIOS4remXtOS7tu+8jFxuICogXG4gKiAxLuWFiOeUqOa0i+iRseaooeWei++8jFxiYSgpLGIoKSxjKCkgPSBhKGIoYygpKSkg6L+Z5Liq55qE5pa55byP5YyF6KO5IGRpc3BhdGNoO1xuICog6ZyA6KaB6YeN5YaZIGNyZWF0ZVN0b3JlIOS7peWPiumcgOimgeWQpyBzdG9yZS5kaXNwYXRjaCDnu5nmm7/mjaLmjolcbiAqIFxuICogQHBhcmFtIG1pZGRsZXdhcmVzIFxuICovXG5jb25zdCBhcHBseU1pZGRsZVdhcmVzID0gKC4uLm1pZGRsZXdhcmVzOiBNaWRkbGV3YXJlW10pID0+IHtcblxuICAvKipvbGRDcmVhdGVTdG9yZUZOIOaYr+S5i+WJjeeahCBjcmVhdGVTdG9yZSAqL1xuICByZXR1cm4gKG9sZENyZWF0ZVN0b3JlRk46IEZ1bmN0aW9uKSA9PiB7XG5cbiAgICAvKirov5nph4zph43lhpnkuoYgY3JlYXRlU3RvcmUg5pa55rOV5bm25LiUIOabv+aNouS6hiBkaXNwYXRjaCDnmoTlh73mlbDlm6DlrZAgKi9cbiAgICByZXR1cm4gZnVuY3Rpb24gbmV3Q3JlYXRlU3RvcmUocmVkdWNlcjogUmVkdWNlciwgaW5pdFN0YXRlOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUubG9nKHJlZHVjZXIsaW5pdFN0YXRlKTtcbiAgICAgIGxldCBzdG9yZTogU3RvcmUgPSBvbGRDcmVhdGVTdG9yZUZOKHJlZHVjZXIsIGluaXRTdGF0ZSk7XG5cbiAgICAgIC8v6K6+572u5Lit6Ze05Lu255qEIHN0YXRlXG4gICAgICBsZXQgY2hhaW4gPSBtaWRkbGV3YXJlcy5tYXAobWlkZGxld2FyZSA9PiB7XG4gICAgICAgIHJldHVybiBtaWRkbGV3YXJlKHN0b3JlLmdldFN0YXRlKTtcbiAgICAgIH0pXG5cbiAgICAgIC8qKuS4remXtOS7tuWMheijuSAuZGlzcGF0Y2gg5pa55rOV77yM6L+Z5Liq5piv5LiA5Liq57uE5ZCI6aKX57KS5YyW55qE5LiA5Liq6L+H56iLICovXG4gICAgICBsZXQgZGlzcGF0Y2ggPSBjb21wb3NlKC4uLmNoYWluKShzdG9yZS5kaXNwYXRjaCk7XG4gICAgICBzdG9yZS5kaXNwYXRjaCA9IGRpc3BhdGNoO1xuICAgICAgcmV0dXJuIHN0b3JlO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgeyBhcHBseU1pZGRsZVdhcmVzLCBNaWRkbGV3YXJlIH0iXX0=